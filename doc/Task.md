# Terra Lock 開発タスク

## Phase 1: 基盤構築（2時間）

### Task 1.1: プロジェクト初期化
- [x] Rustプロジェクトの作成
- [x] macroquadの依存関係追加
- [x] Cargo.tomlの設定（WebAssembly対応）
- [x] 基本的なmain.rs作成

### Task 1.2: 基本ゲームループ実装
- [x] macroquadベースのゲームループ確立
- [x] 60FPS維持の確認
- [x] 画面クリア処理（黒背景）
- [x] 基本的なゲーム状態構造体定義

### Task 1.3: マウス入力処理実装
- [x] マウス座標取得機能
- [x] マウス左ボタンの押下・長押し・リリース検出
- [x] 入力状態管理構造体の実装

### Task 1.4: 基本描画システム
- [x] Vec2数学ライブラリの統合
- [x] 基本図形描画機能の確認
- [x] 画面サイズ設定（800x600px）

### Task 1.5: WebAssembly環境構築（リスク対策）
- [x] WebAssemblyツールチェーンの追加
- [x] 基本的なWeb環境テスト用HTMLファイル作成
- [x] WebAssembly初回ビルドと動作確認
- [x] デュアル環境開発体制の確立
- [x] Rust 1.88.0への更新とmacroquad 0.4.14対応
- [x] PythonHTTPサーバーによる配信環境構築

## Phase 2: コアゲームプレイ（3時間）

### Task 2.1: 自機システム実装
- [x] Player構造体の定義
- [x] 自機の描画（青い三角形、20x15px）
- [x] マウス座標への追従移動
- [x] 画面内移動制限の実装

### Task 2.2: 敵機システム実装
- [x] Enemy構造体の定義
- [x] 敵機の描画（赤い円、直径20px）
- [x] 画面上部からの出現システム
- [x] 直線移動（120px/秒）の実装
- [x] 敵機の自動削除（画面外）

### Task 2.3: 通常レーザーシステム実装
- [x] NormalLaser構造体の定義
- [x] レーザーの描画（シアンの線、幅3px）
- [x] 左クリックでの発射システム
- [x] 上向き移動（300px/秒）の実装
- [x] レーザーの自動削除（寿命・画面外）

### Task 2.4: 当たり判定システム
- [x] レーザーと敵機の当たり判定
- [ ] 敵機と自機の当たり判定
- [ ] 当たり判定時のオブジェクト削除処理

### Task 2.5: 基本スコアシステム
- [ ] スコア管理変数の追加
- [ ] 通常レーザー撃破時のスコア加算（100点）
- [ ] スコア表示UI（左上、白文字）

### Task 2.6: ゲーム状態管理
- [ ] ゲーム状態enum定義（Playing, GameOver）
- [ ] ゲームオーバー判定
- [ ] ゲームオーバー画面表示
- [ ] ゲームリスタート機能

### Task 2.7: WebAssembly継続検証（Phase 2）
- [ ] Phase 2完了時のWebAssembly動作確認
- [ ] パフォーマンス計測とボトルネック特定
- [ ] ブラウザ互換性テスト

## Phase 3: ロックオンシステム（2.5時間）

### Task 3.1: ワイヤーフレーム描画
- [ ] LockOnSystem構造体の定義
- [ ] マウス長押し検出
- [ ] ワイヤーフレーム円の描画（点線、白色）
- [ ] マウス中心でのワイヤーフレーム表示

### Task 3.2: ロックオン判定システム
- [ ] ワイヤーフレーム内の敵機検出
- [ ] 距離計算による判定（平方根回避最適化）
- [ ] 最大6機までのロックオン制限
- [ ] ロックオン対象の管理

### Task 3.3: ロックオン視覚効果
- [ ] ロックオンされた敵機の色変化
- [ ] ロックオン数に応じたワイヤーフレーム色変化
- [ ] ロックオン数表示UI（左上、黄文字）

### Task 3.4: ホーミングレーザーシステム
- [ ] LockOnLaser構造体の定義
- [ ] マウスボタンリリース時の一斉発射
- [ ] ホーミング軌道計算（ベジェ曲線）
- [ ] ロックオンレーザーの描画（黄色い追尾線）

### Task 3.5: ロックオン解除システム
- [ ] マウスボタンリリース時の解除
- [ ] 敵機がワイヤーフレーム外移動時の解除
- [ ] 敵機撃破時の解除
- [ ] 最大数超過時の古いもの解除

### Task 3.6: ロックオンスコアシステム
- [ ] ロックオンレーザー撃破スコア（200点）
- [ ] 同時ロックオン撃破ボーナス計算
- [ ] ボーナススコアの表示

## Phase 4: 最適化・仕上げ（2時間）

### Task 4.1: パフォーマンス最適化
- [ ] リリースビルド設定の最適化
- [ ] オブジェクトプール実装（敵・レーザー用）
- [ ] スプライトバッチング実装
- [ ] メモリ使用量の最適化

### Task 4.2: UI・UX改善
- [ ] 操作説明の表示（下部、小文字）
- [ ] フォント設定の統一
- [ ] ゲームオーバー画面の改善
- [ ] 視覚効果の調整

### Task 4.3: ゲームバランス調整
- [ ] 敵機出現間隔の調整
- [ ] レーザー速度の微調整
- [ ] スコアバランスの調整
- [ ] 難易度カーブの実装

### Task 4.4: デバッグ機能実装
- [ ] デバッグ情報表示（FPSカウンター）
- [ ] 当たり判定ボックス可視化
- [ ] コンソールログ出力機能

### Task 4.5: WebAssembly最終検証（Phase 4）
- [ ] 全機能のWebAssembly環境動作確認
- [ ] パフォーマンス最適化（60FPS維持確認）
- [ ] クロスブラウザ互換性テスト
- [ ] WebAssembly固有問題の修正

## Phase 5: デプロイメント（30分）

### Task 5.1: WebAssemblyビルド
- [ ] wasm32-unknown-unknownターゲットでのビルド
- [ ] wasm-optによるサイズ最適化
- [ ] バンドルサイズの確認（500KB以下）

### Task 5.2: Webデプロイ準備
- [ ] HTMLファイルの作成
- [ ] JavaScriptローダーの実装
- [ ] 静的ファイルの準備

### Task 5.3: 最終テスト
- [ ] クロスブラウザテスト
- [ ] パフォーマンステスト
- [ ] 操作性の最終確認

## 開発ガイドライン

### コミット戦略
- 各タスク完了時にコミット
- コミットメッセージは「Task X.Y: タスク名」形式
- 動作確認後にコミット実行

### テスト方針
- 各フェーズ完了時に動作確認
- 60FPS維持の確認
- メモリリークの確認
- **WebAssembly環境での継続的検証**

### 品質基準
- コンパイルエラーなし
- 警告の最小化
- 仕様書との整合性確認
- **ネイティブ・WebAssembly両環境での動作保証**

### WebAssembly開発戦略
- **デュアル環境開発**: ネイティブ（高速開発）+ WebAssembly（品質保証）
- **継続的検証**: 各Phase完了時のWeb環境テスト
- **早期問題発見**: WebAssembly固有問題の即座修正

## 成功基準チェックリスト

### 最小成功基準
- [ ] マウスで自機を操作できる
- [ ] 敵機を通常レーザーで撃破できる
- [ ] ワイヤーフレームが表示される
- [ ] ロックオン→一斉レーザーが機能する

### 理想成功基準
- [ ] 蒼穹紅蓮隊のロックオン体験を再現
- [ ] 60FPSで滑らかに動作
- [ ] 直感的で爽快な操作感
- [ ] スコアシステムが機能
